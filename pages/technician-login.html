<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>linko-ftth - فني الصيانة</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* ======== تحسينات صفحة تسجيل الدخول ======== */
        .login-container {
            max-width: 500px;
            padding: 20px;
            animation: fadeIn 0.5s ease-out;
        }

        .login-box {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-hover);
            overflow: hidden;
            animation: slideIn 0.5s ease-out;
            position: relative;
        }

        .login-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--success-color), #3a86ff);
        }

        .login-header {
            padding: 40px 30px 20px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--success-color), #3a86ff);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto 20px;
            box-shadow: var(--box-shadow);
            animation: pulse 2s infinite;
        }

        .logo-icon {
            font-size: 40px;
            color: white;
        }

        .login-header h1 {
            color: var(--success-color);
            margin-bottom: 10px;
            font-size: 32px;
            font-weight: 700;
        }

        .login-header p {
            color: var(--gray-color);
            font-size: 18px;
        }

        .login-form {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .input-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .icon {
            position: absolute;
            right: 15px;
            color: var(--gray-color);
            z-index: 1;
            font-size: 18px;
        }

        .input-container input {
            width: 100%;
            padding: 15px 15px 15px 45px;
            border: 2px solid #e1e5f2;
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
            background-color: #f8f9ff;
        }

        .input-container input:focus {
            border-color: var(--success-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(76, 201, 240, 0.2);
            background-color: white;
        }

        .input-container input:hover {
            border-color: #c6d0f5;
        }

        .form-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .remember-me {
            display: flex;
            align-items: center;
            color: var(--gray-color);
        }

        .remember-me input {
            margin-right: 8px;
            width: 18px;
            height: 18px;
        }

        .forgot-password {
            color: var(--success-color);
            text-decoration: none;
            font-size: 14px;
            transition: var(--transition);
            font-weight: 500;
        }

        .forgot-password:hover {
            text-decoration: underline;
            color: #3a86ff;
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--success-color), #3a86ff);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 18px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
        }

        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow-hover);
        }

        .login-btn:active {
            transform: translateY(-1px);
        }

        .login-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        .login-btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }

        .admin-info {
            text-align: center;
            padding: 20px 30px;
            border-top: 1px solid #eee;
            margin-top: 10px;
            background-color: #f8f9ff;
        }

        .admin-info p {
            color: var(--gray-color);
            margin-bottom: 10px;
            font-size: 14px;
        }

        .admin-info h3 {
            color: var(--success-color);
            margin-bottom: 15px;
        }

        .features-list {
            text-align: right;
            padding: 0 20px;
        }

        .features-list li {
            margin-bottom: 8px;
            color: var(--gray-color);
        }

        .features-list li i {
            color: var(--success-color);
            margin-left: 5px;
        }
 
        /* ======== الرسوم المتحركة ======== */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(76, 201, 240, 0.4);
            }
            70% {
                box-shadow: 0 0 0 15px rgba(76, 201, 240, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(76, 201, 240, 0);
            }
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 1;
            }
            100% {
                transform: scale(50, 50);
                opacity: 0;
            }
        }

        /* ======== رسائل الإشعارات ======== */
        .message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: var(--border-radius);
            color: white;
            font-weight: 500;
            z-index: 2000;
            animation: slideInMessage 0.3s ease-out, fadeOut 0.5s ease-out 2.5s forwards;
            box-shadow: var(--box-shadow);
        }

        .message.success {
            background: linear-gradient(135deg, #4cc9f0, #3a86ff);
        }

        .message.error {
            background: linear-gradient(135deg, #f72585, #b5179e);
        }

        .message.info {
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
        }
 
        @keyframes slideInMessage {
            from {
                opacity: 0;
                transform: translate(-50%, -20px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <!-- شاشة تسجيل الدخول -->
    <div id="loginScreen" class="screen">
        <div class="login-container">
            <div class="login-box">
                <div class="login-header">
                    <div class="logo">
                        <i class="fas fa-tools logo-icon"></i>
                    </div>
                    <h1>linko-ftth</h1>
                    <p>تسجيل دخول فني الصيانة</p>
                </div>
                <form class="login-form" id="loginForm">
                    <div class="form-group">
                        <div class="input-container">
                            <i class="fas fa-user icon"></i>
                            <input type="text" id="username" placeholder="اسم المستخدم" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-container">
                            <i class="fas fa-lock icon"></i>
                            <input type="password" id="password" placeholder="كلمة المرور" required>
                        </div>
                    </div>
                    <div class="form-options">
                        <label class="remember-me">
                            <input type="checkbox" id="remember">
                            <span>تذكرني</span>
                        </label>
                        <a href="#" class="forgot-password">نسيت كلمة المرور؟</a>
                    </div>
                    <button type="submit" class="login-btn">تسجيل الدخول</button>
                </form>
                <div class="admin-info">
                    <h3>نظام إدارة المهام</h3>
                    <p>بصفتك فني صيانة، يمكنك:</p>
                    <ul class="features-list">
                        <li><i class="fas fa-check-circle"></i> عرض المهام المسندة لك</li>
                        <li><i class="fas fa-check-circle"></i> تحديث حالة المهام</li>
                        <li><i class="fas fa-check-circle"></i> إضافة ملاحظات على المهام</li>
                        <li><i class="fas fa-check-circle"></i> عرض تفاصيل المهام</li>
                        <li><i class="fas fa-check-circle"></i> تسجيل الحضور بالبصمة</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- شاشة التطبيق الرئيسية -->
    <div id="appScreen" class="screen hidden">
        <!-- شريط التنقل العلوي -->
        <nav class="top-nav">
            <div class="nav-left">
                <div class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </div>
                <h2>linko-ftth</h2>
            </div>
            <div class="nav-right">
                <div class="search-container">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="بحث...">
                </div>
                <div class="notification-icon">
                    <i class="fas fa-bell"></i>
                    <span class="notification-count">3</span>
                </div>
                <div class="user-profile">
                    <img src="../images/user-avatar.png" alt="صورة المستخدم">
                    <span id="userName">اسم المستخدم</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
        </nav>

        <!-- القائمة الجانبية -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>linko-ftth</h3>
            </div>
            <ul class="sidebar-menu">
                <li class="active">
                    <a href="#" data-page="dashboard">
                        <i class="fas fa-home"></i>
                        <span>لوحة التحكم</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-page="tasks">
                        <i class="fas fa-tasks"></i>
                        <span>المهام</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-page="attendance">
                        <i class="fas fa-fingerprint"></i>
                        <span>تسجيل الحضور</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-page="reports">
                        <i class="fas fa-chart-bar"></i>
                        <span>التقارير</span>
                    </a>
                </li>
                <li class="logout">
                    <a href="#">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>تسجيل الخروج</span>
                    </a>
                </li>
            </ul>
        </aside>

        <!-- محتوى التطبيق -->
        <main class="main-content">
            <!-- صفحة المهام -->
            <div id="tasksPage" class="page active">
                <div class="dashboard-header">
                    <h1>لوحة التحكم الرئيسية</h1>
                    <p>مرحباً بك في نظام linko-ftth. من هنا يمكنك متابعة المهام المسندة إليك وتسجيل الحضور.</p>
                </div>
                
                <div class="page-header">
                    <h1>مهامي</h1>
                    <div class="page-actions">
                        <button class="btn" id="exportTasksBtn"><i class="fas fa-file-export"></i> تصدير التقارير</button>
                    </div>
                </div>

                <!-- فلتر المهام -->
                <div class="tasks-filters">
                    <div class="filter-group">
                        <label>نوع المهمة:</label>
                        <select id="taskTypeFilter">
                            <option value="all">الكل</option>
                            <option value="critical">ضروري جداً</option>
                            <option value="important">ضروري</option>
                            <option value="normal">عادي</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>الحالة:</label>
                        <select id="taskStatusFilter">
                            <option value="all">الكل</option>
                            <option value="received">تم الاستلام</option>
                            <option value="in-progress">قيد التنفيذ</option>
                            <option value="completed">منجز</option>
                        </select>
                    </div>
                </div>

                <!-- إحصائيات المهام -->
                <div class="stats-container">
                    <div class="stat-card blue">
                        <div class="stat-icon blue">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalTasksCount">12</h3>
                            <p>إجمالي مهامي</p>
                        </div>
                    </div>
                    <div class="stat-card green">
                        <div class="stat-icon green">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="completedTasksCount">5</h3>
                            <p>مهامي المكتملة</p>
                        </div>
                    </div>
                    <div class="stat-card yellow">
                        <div class="stat-icon yellow">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="inProgressTasksCount">4</h3>
                            <p>مهامي قيد التنفيذ</p>
                        </div>
                    </div>
                    <div class="stat-card red">
                        <div class="stat-icon red">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="receivedTasksCount">3</h3>
                            <p>مهامي المعلقة</p>
                        </div>
                    </div>
                </div>

                <!-- جدول المهام -->
                <div class="tasks-table-container">
                    <div class="table-responsive">
                        <table class="tasks-table">
                            <thead>
                                <tr>
                                    <th>المهمة</th>
                                    <th>نوع الجهاز</th>
                                    <th>الأولوية</th>
                                    <th>التاريخ</th>
                                    <th>الحالة</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="tasksTableBody">
                                <!-- سيتم ملء هذا الجدول ديناميكيًا باستخدام JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- نافذة عرض/تعديل المهمة -->
    <div id="taskDetailsModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>تفاصيل المهمة</h2>
                <button class="close-modal" id="closeTaskDetailsModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="taskDetailsContent">
                <!-- سيتم ملء هذا المحتوى ديناميكيًا باستخدام JavaScript -->
            </div>
        </div>
    </div>

    <!-- نافذة إضافة ملاحظة -->
    <div id="addNoteModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>إضافة ملاحظة</h2>
                <button class="close-modal" id="closeAddNoteModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addNoteForm">
                <div class="form-group">
                    <label for="noteText">نص الملاحظة</label>
                    <textarea id="noteText" rows="4" required></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" id="cancelAddNote">إلغاء</button>
                    <button type="submit" class="btn primary">إضافة الملاحظة</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // تحميل المهام من التخزين المحلي
            let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
            
            // تحميل اسم المستخدم من التخزين المحلي
            const username = localStorage.getItem('username') || 'فني الصيانة';
            document.getElementById('userName').textContent = username;

            // تحديث إحصائيات المهام
            updateTaskStats();
            
            // عرض المهام في الجدول
            displayTasks();

            // فلترة المهام عند تغيير الفلاتر
            document.getElementById('taskTypeFilter').addEventListener('change', displayTasks);
            document.getElementById('taskStatusFilter').addEventListener('change', displayTasks);

            // إغلاق نافذة تفاصيل المهمة
            document.getElementById('closeTaskDetailsModal').addEventListener('click', function() {
                document.getElementById('taskDetailsModal').classList.add('hidden');
            });

            // إغلاق نافذة إضافة ملاحظة
            document.getElementById('closeAddNoteModal').addEventListener('click', function() {
                document.getElementById('addNoteModal').classList.add('hidden');
            });

            document.getElementById('cancelAddNote').addEventListener('click', function() {
                document.getElementById('addNoteModal').classList.add('hidden');
            });

            // إضافة ملاحظة
            document.getElementById('addNoteForm').addEventListener('submit', function(e) {
                e.preventDefault();

                const noteText = document.getElementById('noteText').value;
                const currentTaskId = document.getElementById('addNoteForm').dataset.taskId;

                const taskIndex = tasks.findIndex(task => task.id == currentTaskId);
                if (taskIndex !== -1) {
                    tasks[taskIndex].notes.push({
                        text: noteText,
                        createdAt: new Date().toISOString()
                    });

                    tasks[taskIndex].updatedAt = new Date().toISOString();
                    saveTasks();

                    // إعادة تعيين النموذج وإغلاق النافذة
                    document.getElementById('addNoteForm').reset();
                    document.getElementById('addNoteModal').classList.add('hidden');

                    // تحديث عرض تفاصيل المهمة
                    displayTaskDetails(currentTaskId);

                    // عرض رسالة نجاح
                    showMessage('تم إضافة الملاحظة بنجاح', 'success');
                }
            });

            // تحديث إحصائيات المهام
            function updateTaskStats() {
                const totalTasks = tasks.length;
                const completedTasks = tasks.filter(task => task.status === 'completed').length;
                const inProgressTasks = tasks.filter(task => task.status === 'in-progress').length;
                const receivedTasks = tasks.filter(task => task.status === 'received').length;

                document.getElementById('totalTasksCount').textContent = totalTasks;
                document.getElementById('completedTasksCount').textContent = completedTasks;
                document.getElementById('inProgressTasksCount').textContent = inProgressTasks;
                document.getElementById('receivedTasksCount').textContent = receivedTasks;
            }

            // عرض المهام في الجدول
            function displayTasks() {
                const taskTypeFilter = document.getElementById('taskTypeFilter').value;
                const taskStatusFilter = document.getElementById('taskStatusFilter').value;
                
                // الحصول على اسم المستخدم لتحديد الفني
                const username = localStorage.getItem('username') || 'tech1';

                let filteredTasks = tasks.filter(task => task.technician === username);

                if (taskTypeFilter !== 'all') {
                    filteredTasks = filteredTasks.filter(task => task.type === taskTypeFilter);
                }

                if (taskStatusFilter !== 'all') {
                    filteredTasks = filteredTasks.filter(task => task.status === taskStatusFilter);
                }

                const tbody = document.getElementById('tasksTableBody');
                tbody.innerHTML = '';

                filteredTasks.forEach(task => {
                    const row = document.createElement('tr');

                    // تحديد أولوية المهمة
                    let priorityText = 'متوسطة';
                    let priorityClass = 'medium';
                    if (task.priority === 'high') {
                        priorityText = 'عالية';
                        priorityClass = 'high';
                    } else if (task.priority === 'low') {
                        priorityText = 'منخفضة';
                        priorityClass = 'low';
                    } else if (task.priority === 'critical') {
                        priorityText = 'حرجة';
                        priorityClass = 'critical';
                    }

                    // تحديد الجهاز
                    let deviceText = task.device || 'غير محدد';
                    if (deviceText === 'router') deviceText = 'راوتر';
                    else if (deviceText === 'switch') deviceText = 'محول';
                    else if (deviceText === 'server') deviceText = 'خادم';
                    else if (deviceText === 'firewall') deviceText = 'جدار ناري';
                    else if (deviceText === 'wireless') deviceText = 'شبكة لاسلكية';
                    else if (deviceText === 'fiber') deviceText = 'ألياف ضوئية';
                    else if (deviceText === 'other') deviceText = 'جهاز آخر';

                    // تحديد حالة المهمة
                    let statusText = 'تم الاستلام';
                    let statusClass = 'received';
                    if (task.status === 'in-progress') {
                        statusText = 'قيد التنفيذ';
                        statusClass = 'in-progress';
                    } else if (task.status === 'completed') {
                        statusText = 'منجز';
                        statusClass = 'completed';
                    }

                    row.innerHTML = `
                        <td>${task.title}</td>
                        <td>${deviceText}</td>
                        <td><span class="task-type ${task.priority}">${priorityText}</span></td>
                        <td>${new Date(task.createdAt).toLocaleDateString('ar-EG')}</td>
                        <td><span class="status ${task.status}">${statusText}</span></td>
                        <td>
                            <button class="btn-icon" onclick="displayTaskDetails(${task.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon" onclick="updateTaskStatus(${task.id})">
                                <i class="fas fa-check"></i>
                            </button>
                        </td>
                    `;

                    tbody.appendChild(row);
                });
            }

            // عرض تفاصيل المهمة
            function displayTaskDetails(taskId) {
                const task = tasks.find(t => t.id === taskId);
                if (!task) return;

                const taskDetailsContent = document.getElementById('taskDetailsContent');

                // تحديد نوع المهمة
                let typeText = 'عادي';
                if (task.type === 'important') typeText = 'ضروري';
                if (task.type === 'critical') typeText = 'ضروري جداً';

                // تحديد حالة المهمة
                let statusText = 'تم الاستلام';
                let statusClass = 'received';
                if (task.status === 'in-progress') {
                    statusText = 'قيد التنفيذ';
                    statusClass = 'in-progress';
                } else if (task.status === 'completed') {
                    statusText = 'منجز';
                    statusClass = 'completed';
                }

                // تحديد أسماء الأعضاء
                const member1Name = getMemberName(task.members[0]);
                const member2Name = getMemberName(task.members[1]);

                taskDetailsContent.innerHTML = `
                    <div class="task-details">
                        <div class="detail-row">
                            <div class="detail-label">عنوان المهمة:</div>
                            <div class="detail-value">${task.title}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">وصف المشكلة:</div>
                            <div class="detail-value">${task.description || 'لا يوجد وصف'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">الجهاز/المعدات:</div>
                            <div class="detail-value">${getDeviceText(task.device)}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">الموقع/القسم:</div>
                            <div class="detail-value">${task.location || 'غير محدد'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">نوع المهمة:</div>
                            <div class="detail-value"><span class="task-type ${task.type}">${getTaskTypeText(task.type)}</span></div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">الأولوية:</div>
                            <div class="detail-value"><span class="task-type ${task.priority}">${getPriorityText(task.priority)}</span></div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">الفريق:</div>
                            <div class="detail-value">${task.team}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">الأعضاء:</div>
                            <div class="detail-value">${member1Name} و ${member2Name}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">اسم المشترك:</div>
                            <div class="detail-value">${task.subscriberName || 'غير محدد'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">رقم هاتف المشترك:</div>
                            <div class="detail-value">${task.subscriberPhone || 'غير محدد'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">العمود/الشارع:</div>
                            <div class="detail-value">${task.subscriberColumn || 'غير محدد'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">المنطقة/الحي:</div>
                            <div class="detail-value">${task.subscriberZone || 'غير محدد'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">الوقت المقدر للإنجاز:</div>
                            <div class="detail-value">${task.estimatedTime ? task.estimatedTime + ' ساعة' : 'غير محدد'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">الأدوات/القطع المطلوبة:</div>
                            <div class="detail-value">${task.tools || 'لا توجد أدوات محددة'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">تاريخ الإنشاء:</div>
                            <div class="detail-value">${new Date(task.createdAt).toLocaleString('ar-EG')}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">الموعد النهائي:</div>
                            <div class="detail-value">${new Date(task.deadline).toLocaleDateString('ar-EG')}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">الحالة:</div>
                            <div class="detail-value"><span class="status ${statusClass}">${statusText}</span></div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">آخر تحديث:</div>
                            <div class="detail-value">${new Date(task.updatedAt).toLocaleString('ar-EG')}</div>
                        </div>

                        <div class="task-notes">
                            <h3>الملاحظات</h3>
                            <div class="notes-list">
                                ${task.notes.length > 0 ? task.notes.map(note => `
                                    <div class="note-item">
                                        <div class="note-text">${note.text}</div>
                                        <div class="note-date">${new Date(note.createdAt).toLocaleString('ar-EG')}</div>
                                    </div>
                                `).join('') : '<p>لا توجد ملاحظات بعد</p>'}
                            </div>
                            <button class="btn primary" id="addNoteBtn" data-task-id="${task.id}">
                                <i class="fas fa-plus"></i> إضافة ملاحظة
                            </button>
                        </div>
                    </div>
                `;

                // إظهار نافذة التفاصيل
                document.getElementById('taskDetailsModal').classList.remove('hidden');

                // إضافة حدث لزر إضافة الملاحظة
                document.getElementById('addNoteBtn').addEventListener('click', function() {
                    document.getElementById('addNoteModal').classList.remove('hidden');
                    document.getElementById('addNoteForm').dataset.taskId = task.id;
                });
            }

            // تحديث حالة المهمة
            function updateTaskStatus(taskId) {
                const task = tasks.find(t => t.id === taskId);
                if (!task) return;

                let newStatus = '';
                let statusText = '';

                if (task.status === 'received') {
                    newStatus = 'in-progress';
                    statusText = 'قيد التنفيذ';
                } else if (task.status === 'in-progress') {
                    newStatus = 'completed';
                    statusText = 'منجز';
                } else {
                    return; // لا يمكن تغيير الحالة إذا كانت منجزة بالفعل
                }

                task.status = newStatus;
                task.updatedAt = new Date().toISOString();

                saveTasks();

                // تحديث العرض
                updateTaskStats();
                displayTasks();

                // عرض رسالة نجاح
                showMessage(`تم تحديث حالة المهمة إلى "${statusText}"`, 'success');
            }

            // حفظ المهام في التخزين المحلي
            function saveTasks() {
                localStorage.setItem('tasks', JSON.stringify(tasks));

                // حفظ نسخة من المهام لمدة يومين
                const tasksBackup = {
                    tasks: tasks,
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem('tasksBackup', JSON.stringify(tasksBackup));
            }

            // الحصول على اسم العضو من المعرف
            function getMemberName(memberId) {
                const members = {
                    'ahmed': 'أحمد محمد',
                    'ali': 'علي سالم',
                    'sara': 'سارة أحمد',
                    'fatima': 'فاطمة خالد',
                    'youssef': 'يوسف أحمد',
                    'nour': 'نور الدين'
                };
                return members[memberId] || memberId;
            }

            // الحصول على نص الجهاز من المعرف
            function getDeviceText(deviceId) {
                const devices = {
                    'router': 'راوتر',
                    'switch': 'محول',
                    'server': 'خادم',
                    'firewall': 'جدار ناري',
                    'wireless': 'شبكة لاسلكية',
                    'fiber': 'ألياف ضوئية',
                    'other': 'جهاز آخر'
                };
                return devices[deviceId] || deviceId;
            }

            // الحصول على نص نوع المهمة من المعرف
            function getTaskTypeText(typeId) {
                const types = {
                    'maintenance': 'صيانة روتينية',
                    'troubleshooting': 'حل مشكلة',
                    'installation': 'تركيب',
                    'upgrade': 'تحديث',
                    'configuration': 'إعدادات'
                };
                return types[typeId] || typeId;
            }

            // الحصول على نص الأولوية من المعرف
            function getPriorityText(priorityId) {
                const priorities = {
                    'low': 'منخفضة',
                    'medium': 'متوسطة',
                    'high': 'عالية',
                    'critical': 'حرجة'
                };
                return priorities[priorityId] || priorityId;
            }

            // عرض رسالة
            function showMessage(message, type) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${type}`;
                messageDiv.textContent = message;

                document.body.appendChild(messageDiv);

                setTimeout(() => {
                    messageDiv.style.opacity = '0';
                    setTimeout(() => {
                        messageDiv.remove();
                    }, 500);
                }, 3000);
            }

            // تسجيل الدخول
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                // التحقق من بيانات المالك (المشرف العام)
                if (username === 'owner' && password === 'owner123') {
                    // حفظ بيانات المستخدم
                    localStorage.setItem('userRole', 'supervisor');
                    localStorage.setItem('username', username);

                    // عرض رسالة نجاح
                    showMessage('مرحباً بك مشرف النظام', 'success');

                    // إعادة تعيين النموذج
                    loginForm.reset();

                    // توجيه إلى لوحة التحكم
                    setTimeout(() => {
                        window.location.href = '../pages/tasks.html';
                    }, 1500);
                } else if (username && password) {
                    // التحقق من بيانات الفنيين المضافين
                    const technicians = JSON.parse(localStorage.getItem('technicians') || '[]');
                    const technician = technicians.find(tech => tech.username === username && tech.password === password);

                    if (technician) {
                        // حفظ بيانات المستخدم
                        localStorage.setItem('userRole', 'technician');
                        localStorage.setItem('username', username);

                        // عرض رسالة نجاح
                        showMessage('مرحباً بك فني الصيانة', 'success');

                        // إعادة تعيين النموذج
                        loginForm.reset();

                        // توجيه إلى لوحة التحكم
                        setTimeout(() => {
                            window.location.href = '../pages/tasks.html';
                        }, 1500);
                    } else {
                        // عرض رسالة خطأ
                        showMessage('بيانات الدخول غير صحيحة', 'error');
                    }
                } else {
                    showMessage('يرجى ملء جميع الحقول', 'error');
                }
            });

            // التحقق من وجود مستخدم مسجل دخوله مسبقًا
            const savedUsername = localStorage.getItem('username');
            if (savedUsername) {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('appScreen').classList.remove('hidden');
                document.getElementById('userName').textContent = savedUsername;
            }

            // خروج المستخدم
            const logoutBtn = document.querySelector('.logout a');
            logoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                if (confirm('هل أنت متأكد من تسجيل الخروج؟')) {
                    // مسح بيانات المستخدم
                    localStorage.removeItem('username');
                    localStorage.removeItem('userRole');

                    // الانت إلى شاشة تسجيل الدخول
                    document.getElementById('appScreen').classList.add('hidden');
                    document.getElementById('loginScreen').classList.remove('hidden');
                }
            });
        });
    </script>
</body>
</html>